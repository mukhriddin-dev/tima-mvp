{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukhriddin/Desktop/tima-app/app/api/telegram/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport type { OrderPayload } from \"@/types/product\"\n\nfunction formatTelegramMessage(order: OrderPayload): string {\n  return `üõç *Yangi buyurtma!*\n\n*Mahsulot:*\n\\`${order.productName}\\`\n\\`ID: ${order.productId}\\`\n\n*Narxi:* \\`${order.price.toLocaleString()} ${order.currency}\\`\n\n*Variant:*\n\\`Rang: ${order.selectedColorLabel}\\`\n\\`O'lcham: ${order.selectedSize} sm (${order.selectedSizeAgeLabel})\\`\n\\`Til: ${order.language}\\`\n\n*Mijoz:*\n\\`Ism: ${order.customerName}\\`\n\\`Telefon: ${order.customerPhone}\\`\n\\`Tuman: ${order.customerDistrict}\\`\n\\`Manzil: ${order.customerAddress}\\`\n${order.comment ? `\\`Izoh: ${order.comment}\\`` : \"\"}\n\n*Rasm:*\n${order.currentImageUrl}\n\n_Vaqt: ${order.timestamp}_`\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const token = process.env.NEXT_TELEGRAM_BOT_TOKEN\n    const chatId = process.env.NEXT_TELEGRAM_CHANNEL_ID\n\n    if (!token || !chatId) {\n      console.warn(\"[Telegram] Credentials not configured, skipping notification\")\n      return NextResponse.json({ success: true, skipped: true })\n    }\n\n    const order: OrderPayload = await request.json()\n    const message = formatTelegramMessage(order)\n    const url = `https://api.telegram.org/bot${token}/sendMessage`\n\n    const response = await fetch(url, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        chat_id: chatId,\n        text: message,\n        parse_mode: \"Markdown\",\n        disable_web_page_preview: false,\n      }),\n    })\n\n    if (!response.ok) {\n      const errorData = await response.text()\n      console.error(\"[Telegram] API error:\", errorData)\n      return NextResponse.json({ success: false, error: errorData }, { status: 500 })\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"[Telegram] Failed to send notification:\", error)\n    return NextResponse.json({ success: false, error: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAGA,SAAS,sBAAsB,KAAmB;IAChD,OAAO,CAAC;;;EAGR,EAAE,MAAM,WAAW,CAAC;MAChB,EAAE,MAAM,SAAS,CAAC;;WAEb,EAAE,MAAM,KAAK,CAAC,cAAc,GAAG,CAAC,EAAE,MAAM,QAAQ,CAAC;;;QAGpD,EAAE,MAAM,kBAAkB,CAAC;WACxB,EAAE,MAAM,YAAY,CAAC,KAAK,EAAE,MAAM,oBAAoB,CAAC;OAC3D,EAAE,MAAM,QAAQ,CAAC;;;OAGjB,EAAE,MAAM,YAAY,CAAC;WACjB,EAAE,MAAM,aAAa,CAAC;SACxB,EAAE,MAAM,gBAAgB,CAAC;UACxB,EAAE,MAAM,eAAe,CAAC;AAClC,EAAE,MAAM,OAAO,GAAG,CAAC,QAAQ,EAAE,MAAM,OAAO,CAAC,EAAE,CAAC,GAAG,GAAG;;;AAGpD,EAAE,MAAM,eAAe,CAAC;;OAEjB,EAAE,MAAM,SAAS,CAAC,CAAC,CAAC;AAC3B;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,QAAQ,QAAQ,GAAG,CAAC,uBAAuB;QACjD,MAAM,SAAS,QAAQ,GAAG,CAAC,wBAAwB;QAEnD,IAAI,CAAC,SAAS,CAAC,QAAQ;YACrB,QAAQ,IAAI,CAAC;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAM,SAAS;YAAK;QAC1D;QAEA,MAAM,QAAsB,MAAM,QAAQ,IAAI;QAC9C,MAAM,UAAU,sBAAsB;QACtC,MAAM,MAAM,CAAC,4BAA4B,EAAE,MAAM,YAAY,CAAC;QAE9D,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB,SAAS;gBACT,MAAM;gBACN,YAAY;gBACZ,0BAA0B;YAC5B;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAU,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2CAA2C;QACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF"}}]
}